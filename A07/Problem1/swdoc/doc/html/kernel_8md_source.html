<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hc08kernel: kernel.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hc08kernel
   &#160;<span id="projectnumber">1.00</span>
   </div>
   <div id="projectbrief">Minimal Embedded-Kernel</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">kernel.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="kernel_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Introduction to the HC08 Minimal Kernel {#mainpage}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;@author Andreas Kugel</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;## Simple portable pre-empting scheduler</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;### Components:</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; * [Scheduler](@ref scheduler)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; * [Scheduler API](@ref scheduler_api)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; * [Main Interrupt Handler](@ref InterruptHandler)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; * [Application Configuration](@ref application_config)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; * [Example](@ref scheduler_example)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;## Kernel Documentation</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; * Scheduler</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;   * The scheduler is the only module which needs to use assembly code and this is limited to the interrupt handlers and to the core scheduling function, when the stack must be accessed or manipulated. These code sections would need to be modified in order to support a different target processor or a different compiler.</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;     - An exception are the [macros](@ref scheduler_api) CLI, SEI and WAIT, which insert assembly sections into the user code, but they don&#39;t expose assembly to the user. However, they also must be ported to different targets.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;   * [Timebase interrupt](@ref ScIsr)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;     - This is the main interrupt handler. Other handlers will need to add their hooks here (see example). This might be different on processor architectures which different interrupt hardware, e.g. more than 1 interrupt line or with a vectorized interrupt controller.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;     - Other handlers will typically perform some action resulting in a change of the scheduler resources, e.g. writing data into a mailbox. At the end of their processing, they need to [call the scheduler](@ref ScRescheduleFromIsr) to update the scheduler state.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;       - See example code for GPIO interrupt via mailbox</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;   * [Create tasks from functions](@ref ScTaskPrioCreate)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;     - Insert task and task stack into stack list</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;       - Take care of required stack space: complex functions need more space than the default stack</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;     - Handle two task priorities: low and high</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;   * [Preempt and re-schedule tasks at timebase IRQ](@ref ScReschedule)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;   * [Start Scheduler as last action in main (see example)](@ref ScStart)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; * Mailbox</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;   - Inter-task message passing:</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      Send data (bytes) from task to task with notification</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;     - [Blocking wait for mailbox](@ref ScmBoxPend)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;       - Calling task unscheduled until data available</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;     - [Blocking write to mailbox](@ref ScmBoxPost)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;       - Calling task unscheduled if mailbox not free</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;     - [Nonblocking check of mailbox status](@ref ScmBoxIsValid)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;       - [Determine if a blocking call will succeed](@ref ScmBoxIsValid)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; * Mutex</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;   - Inter-task resource sharing</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;   - [Acquire mutex](@ref ScmutexTake)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;       - Calling task unscheduled until mutex free</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;   - [Release mutex](@ref ScmutexRelease)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; * Timing</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;   - Handle delays and provide local time reference</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   - [Delay task for some number of scheduler ticks](@ref ScTimeBlock)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   - [Get current timestamp in number of scheduler ticks](@ref ScGetTicks)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;@anchor Tracing</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;## Tracing</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;The example implementation allows to trace the state of the scheduler resources by placing the scheduler variables at specific memory locations which are inspected by some special VHDL code. This can be used to observe the behaviour at run-time using FPGA debugging features (signal-tap, chipscope, etc). The same mechansim can be used to analyze program execution in simulation, by logging address and scheduler states to a file. Task-switches, interupts etc. can then be visualized.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;&lt;img src=&quot;../kernel_trace.png&quot; width=&quot;80%&quot; style=&quot;margin-left:50px&quot;&gt;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;@image latex &quot;../kernel_trace.png&quot;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;## Peripherals</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;Peripheral address map is [here](@ref peripherals)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
