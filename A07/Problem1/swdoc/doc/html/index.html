<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hc08kernel: Introduction to the HC08 Minimal Kernel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hc08kernel
   &#160;<span id="projectnumber">1.00</span>
   </div>
   <div id="projectbrief">Minimal Embedded-Kernel</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Introduction to the HC08 Minimal Kernel </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Andreas Kugel</dd></dl>
<h2>Simple portable pre-empting scheduler</h2>
<h3>Components:</h3>
<ul>
<li><a class="el" href="group__scheduler.html">Scheduler</a></li>
<li><a class="el" href="group__scheduler__api.html">Scheduler API</a></li>
<li><a class="el" href="group___interrupt_handler.html">Main Interrupt Handler</a></li>
<li><a class="el" href="group__application__config.html">Application Configuration</a></li>
<li><a class="el" href="group__scheduler__example.html">Example</a></li>
</ul>
<h2>Kernel Documentation</h2>
<ul>
<li>Scheduler<ul>
<li>The scheduler is the only module which needs to use assembly code and this is limited to the interrupt handlers and to the core scheduling function, when the stack must be accessed or manipulated. These code sections would need to be modified in order to support a different target processor or a different compiler.<ul>
<li>An exception are the <a class="el" href="group__scheduler__api.html">macros</a> CLI, SEI and WAIT, which insert assembly sections into the user code, but they don't expose assembly to the user. However, they also must be ported to different targets.</li>
</ul>
</li>
<li><a class="el" href="group__scheduler.html#ga3367fc6895fc301def9212810dcbaed3">Timebase interrupt</a><ul>
<li>This is the main interrupt handler. Other handlers will need to add their hooks here (see example). This might be different on processor architectures which different interrupt hardware, e.g. more than 1 interrupt line or with a vectorized interrupt controller.</li>
<li>Other handlers will typically perform some action resulting in a change of the scheduler resources, e.g. writing data into a mailbox. At the end of their processing, they need to <a class="el" href="group__scheduler.html#gafa6ec9745931008ff4b457ed08dfc84d">call the scheduler</a> to update the scheduler state.<ul>
<li>See example code for GPIO interrupt via mailbox</li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="group__scheduler.html#gac85638f5397586a6e4b3242cdaaffcba">Create tasks from functions</a><ul>
<li>Insert task and task stack into stack list<ul>
<li>Take care of required stack space: complex functions need more space than the default stack</li>
</ul>
</li>
<li>Handle two task priorities: low and high</li>
</ul>
</li>
<li><a class="el" href="group__scheduler.html#ga0f723fd35ed9f861736ca8ca20ba1048">Preempt and re-schedule tasks at timebase IRQ</a></li>
<li><a class="el" href="group__scheduler.html#ga0d6dbbf85ee2d9079e676fd34e585d26">Start Scheduler as last action in main (see example)</a></li>
</ul>
</li>
<li>Mailbox<ul>
<li>Inter-task message passing: Send data (bytes) from task to task with notification<ul>
<li><a class="el" href="group__scheduler.html#ga09768b12ba6ca900f6c48204873ffe83">Blocking wait for mailbox</a><ul>
<li>Calling task unscheduled until data available</li>
</ul>
</li>
<li><a class="el" href="group__scheduler.html#ga5ee2f969a651f12a649a0ba5160e117b">Blocking write to mailbox</a><ul>
<li>Calling task unscheduled if mailbox not free</li>
</ul>
</li>
<li><a class="el" href="group__scheduler.html#gaa0fe71a1f3149550b15648b40d333b98">Nonblocking check of mailbox status</a><ul>
<li><a class="el" href="group__scheduler.html#gaa0fe71a1f3149550b15648b40d333b98">Determine if a blocking call will succeed</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Mutex<ul>
<li>Inter-task resource sharing</li>
<li><a class="el" href="group__scheduler.html#ga66ad252c91ffe99d9703dc66884e7009">Acquire mutex</a><ul>
<li>Calling task unscheduled until mutex free</li>
</ul>
</li>
<li><a class="el" href="group__scheduler.html#ga3a4b3e3f3891ff481f7f949411c45e91">Release mutex</a></li>
</ul>
</li>
<li>Timing<ul>
<li>Handle delays and provide local time reference</li>
<li><a class="el" href="group__scheduler.html#ga5ac88d591a00c65f8baf87eab6c67485">Delay task for some number of scheduler ticks</a></li>
<li><a class="el" href="group__scheduler.html#gacc088ae3b3577f77461f756f953e9fbf">Get current timestamp in number of scheduler ticks</a></li>
</ul>
</li>
</ul>
<p><a class="anchor" id="Tracing"></a></p><h2>Tracing</h2>
<p>The example implementation allows to trace the state of the scheduler resources by placing the scheduler variables at specific memory locations which are inspected by some special VHDL code. This can be used to observe the behaviour at run-time using FPGA debugging features (signal-tap, chipscope, etc). The same mechansim can be used to analyze program execution in simulation, by logging address and scheduler states to a file. Task-switches, interupts etc. can then be visualized. </p><div class="image">
<img src="../kernel_trace.png" width="80%" style="margin-left:50px"/>
</div>
 <h2>Peripherals</h2>
<p>Peripheral address map is <a class="el" href="group__peripherals.html">here</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
